<!--
type Context struct {
    Query   string
    Results []struct {
        Name              string
        Confidence        int
        PackageName       string
        PackageImportPath string
        PrettyTokens      []struct {
            Text string
            Kind string
        }
    }
}

Token kinds:
- comment
- embedded_name
- embedded_package
- field_name
- interface_name
- keyword
- method_name
- punctuation
- field_type
- whitespace
Fronted-only kinds:
- literal
-->

{{- define "title" -}}
    {{- .Query -}}
{{- end -}}

{{- define "description" -}}
    Results for '{{- .Query -}}' query.
{{- end -}}

{{- define "head" -}}
    <style>
        .result {
            margin: 0 0 4rem;
        }

        .result .full-name {
            font-weight: 600;
            margin-top: 0;
        }

        .result .full-name a {
            color: #005cc5;
        }

        .result .confidence {
            color: #ccc;
            user-select: none; -moz-user-select: none;
        }

        code {
            border-radius: 0.2em;
            border: 1px solid #eee;
            color: #24292e;
            display: block;
            font-family: 'SFMono-Regular', 'Consolas', 'Liberation Mono', 'Menlo', 'Courier', 'monospace';
            line-height: 1.5;
            margin: 1em 0;
            padding: 1em;
            tab-size: 4; -moz-tab-size: 4;
            white-space: pre-wrap;
        }

        code .comment {color: #6a737d;}
        code .embedded_package, code .embedded_name, code .literal {color: #032f62;}
        code .field_type, code .interface_name {color: #6f42c1;}
        code .keyword {color: #d73a49;}
        code .method_name {color: #005cc5;}
    </style>
{{- end -}}

{{- define "query" -}}
    {{- .Query -}}
{{- end -}}

{{- define "body" -}}
    {{- range $i, $result := .Results -}}
        <div class="result">
            <!-- TODO show confidence? -->
            <h2 class="full-name">
                {{- $result.PackageName -}}.<!--
             --><a href="https://godoc.org/{{- $result.PackageImportPath -}}#{{- $result.Name -}}">
                    {{- $result.Name -}}
                </a>
                <span class="confidence">
                    {{- $result.Confidence -}}%
                </span>
            </h2>
            <code><!--
             --><span class="keyword">import</span><!--
             --><span class="whitespace"> </span><!--
             --><span class="literal">"{{- $result.PackageImportPath -}}"</span><!--
         --></code>
            <code>
                {{- range $_, $token := .PrettyTokens -}}
                    <span class="{{- $token.Kind -}}">{{- $token.Text -}}</span>
                {{- end -}}
            </code>
        </div>
    {{- end -}}

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            var transparencyValue = 0.5;
            var graceZoneSize = 40;

            var header = document.querySelector("header");
            var headerHeight = header.offsetHeight;
            var triggerHeight = headerHeight - graceZoneSize;

            var observer = new IntersectionObserver(function(entries) {
                for (var entry of entries) {
                    var isPartiallyHidden = entry.intersectionRatio < 1;
                    var intersectionIsSmallerThanHeaderHeight = entry.intersectionRect.height < headerHeight;
                    var shouldDim = isPartiallyHidden && intersectionIsSmallerThanHeaderHeight;
                    entry.target.style.opacity = shouldDim ? transparencyValue : 1;
                }
            }, {
                // Only make transparent when going off the top of the screen.
                rootMargin: "-" + triggerHeight + "px 0px 99999999px",
                // Trigger observer more often when near the point where it should go transparent.
                threshold: [0, 0.025, 0.05, 0.075, 0.1, 0.15, 0.2, 0.25, 0.3, 0.5, 0.75, 1],
            });

            var results = document.querySelectorAll(".result");
            for (var result of results) {
                observer.observe(result);
            }
        });
    </script>
{{- end -}}
